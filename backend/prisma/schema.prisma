generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  username  String   @unique
  password  String
  fullName  String
  role      String   @default("USER") // ADMIN, ACCOUNTANT, USER
  permissions String @default("[]") // JSON String of specific permissions e.g. ["create_voucher", "view_reports"]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  branch    Branch?  @relation(fields: [branchId], references: [id])
  branchId  Int?

  vouchers  Voucher[]
  logs      AuditLog[]
}

model Supplier {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  phone     String?
  email     String?
  address   String?
  createdAt DateTime @default(now())
  
  branch    Branch?  @relation(fields: [branchId], references: [id])
  branchId  Int?

  vouchers  Voucher[]
}

model Branch {
  id        Int      @id @default(autoincrement())
  name      String   @unique
  location  String?
  createdAt DateTime @default(now())
  
  users     User[]
  suppliers Supplier[]
}

model Voucher {
  id          Int      @id @default(autoincrement())
  voucherNo   String   @unique
  date        DateTime @default(now())
  amount      Decimal
  paymentMethod String // Cash, Check, Transfer
  description String?
  
  supplier    Supplier? @relation(fields: [supplierId], references: [id])
  supplierId  Int?
  
  // Keep supplierName as backup or for manual entry if needed, but we rely on ID
  supplierName String? 

  createdBy   User     @relation(fields: [createdById], references: [id])
  createdById Int
  updatedAt   DateTime @updatedAt
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  action    String
  entity    String
  entityId  String?
  details   String?
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
  timestamp DateTime @default(now())
}
